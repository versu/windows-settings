# スタートアップアプリ登録スクリプト仕様書

## 概要

PowerShellで作成された、Windowsのスタートアップフォルダにアプリケーションのショートカットを登録・管理するためのスクリプトです。対話モードとパラメータモードの両方をサポートし、現在のユーザー用および全ユーザー用の設定が可能です。

## 機能一覧

### 主要機能

1. **ショートカット追加**
   - 指定したアプリケーションのスタートアップショートカットを作成
   - 起動引数の指定が可能
   - 作業ディレクトリの指定が可能
   - アイコンの自動設定

2. **ショートカット削除**
   - 既存のスタートアップショートカットを削除

3. **ショートカット一覧表示**
   - 現在登録されているスタートアップショートカットを表示
   - 現在のユーザー用と全ユーザー用を区別して表示

### 補助機能

- 既存ショートカットの上書き確認
- アプリケーションパスの存在確認
- エラーハンドリングと詳細なメッセージ表示
- 色分けされたコンソール出力

## 実行モード

### 1. 対話モード

パラメータなしで実行すると対話モードになります。

```powershell
.\startup-app.ps1
```

**対話モードの流れ：**
1. 現在のスタートアップショートカット一覧を表示
2. 操作選択メニューを表示（追加/削除/終了）
3. 選択した操作に応じた入力プロンプトを表示
4. 処理実行

### 2. パラメータモード

コマンドライン引数を指定して実行するモードです。

```powershell
.\startup-app.ps1 -AppPath "C:\Program Files\MyApp\app.exe" [オプション]
```

## パラメータ仕様

### 必須パラメータ

| パラメータ名 | 型 | 説明 |
|-------------|----|----|
| `AppPath` | string | 登録するアプリケーションのフルパス |

### オプションパラメータ

| パラメータ名 | 型 | デフォルト値 | 説明 |
|-------------|----|-----------|----|
| `ShortcutName` | string | 実行ファイル名 | 作成するショートカットの名前（.lnk拡張子は自動付与） |
| `Arguments` | string | 空文字列 | アプリケーション起動時の引数 |
| `WorkingDirectory` | string | 実行ファイルのディレクトリ | 作業ディレクトリのパス |
| `AllUsers` | switch | false | 全ユーザー用に設定する場合に指定 |

## 使用例

### 基本的な使用例

```powershell
# Notepad++をスタートアップに登録
.\startup-app.ps1 -AppPath "C:\Program Files\Notepad++\notepad++.exe"

# 電卓をカスタム名で登録
.\startup-app.ps1 -AppPath "C:\Windows\System32\calc.exe" -ShortcutName "電卓"

# 引数付きでアプリを登録
.\startup-app.ps1 -AppPath "C:\MyApp\app.exe" -Arguments "--minimized --auto-start"
```

### 全ユーザー用設定

```powershell
# 管理者権限で実行が必要
.\startup-app.ps1 -AppPath "C:\Program Files\CompanyApp\app.exe" -AllUsers
```

### 対話モード使用例

```powershell
PS> .\startup-app.ps1

=== スタートアップアプリ登録スクリプト ===

対話モードで実行します。

=== 現在のユーザー用スタートアップショートカット ===
フォルダ: C:\Users\Username\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

• MyApp.lnk

=== 全ユーザー用スタートアップショートカット ===
フォルダ: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup

ショートカットが見つかりません。

操作を選択してください:
1. ショートカットを追加
2. ショートカットを削除
3. 終了

選択 (1-3): 1
アプリケーションのフルパスを入力してください: C:\Program Files\MyApp\app.exe
ショートカット名を入力してください（空白の場合は自動設定）: 
起動引数を入力してください（不要な場合は空白）: 
全ユーザー用に設定しますか？ (Y/N): N

✓ スタートアップショートカットが正常に作成されました:
  ファイル: C:\Users\Username\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\app.lnk
  対象: C:\Program Files\MyApp\app.exe

処理が完了しました。
```

## 内部関数仕様

### Add-StartupShortcut

**用途：** ショートカットを作成する主要関数

**パラメータ：**
- `TargetPath` (string): 対象アプリケーションのパス
- `Name` (string): ショートカット名
- `Args` (string): 起動引数
- `WorkDir` (string): 作業ディレクトリ
- `ForAllUsers` (bool): 全ユーザー用フラグ

**戻り値：** bool（成功時true、失敗時false）

### Remove-StartupShortcut

**用途：** ショートカットを削除する関数

**パラメータ：**
- `Name` (string): 削除するショートカット名
- `ForAllUsers` (bool): 全ユーザー用フラグ

**戻り値：** bool（成功時true、失敗時false）

### Show-StartupShortcuts

**用途：** 現在のショートカット一覧を表示する関数

**パラメータ：**
- `ForAllUsers` (bool): 全ユーザー用フラグ

**戻り値：** なし

## エラーハンドリング

### 検証項目

1. **アプリケーションパスの存在確認**
   - 指定されたパスにファイルが存在するかチェック
   - 存在しない場合はエラーメッセージを表示して処理を中断

2. **既存ショートカットの確認**
   - 同名のショートカットが既に存在する場合は上書き確認
   - ユーザーが拒否した場合は処理をキャンセル

3. **権限の確認**
   - 全ユーザー用設定時の管理者権限確認は自動的に行われる
   - 権限不足の場合はWindowsがエラーを表示

### エラーメッセージ例

- `指定されたアプリケーションが見つかりません: [パス]`
- `ショートカットの作成中にエラーが発生しました: [詳細]`
- `ショートカットの削除中にエラーが発生しました: [詳細]`

## 出力メッセージ

### 色分け仕様

- **緑色**: 成功メッセージ、現在のユーザー情報
- **黄色**: 警告メッセージ、全ユーザー情報
- **赤色**: エラーメッセージ
- **シアン**: 情報メッセージ、パス表示
- **マゼンタ**: タイトル
- **白色**: 通常のリスト項目
- **グレー**: 補助情報

## 必要な権限

### 現在のユーザー用
- 特別な権限は不要
- 通常のユーザー権限で実行可能

### 全ユーザー用
- 管理者権限が必要
- PowerShellを「管理者として実行」で起動する必要がある

## 対象環境

- **OS**: Windows 10/11
- **PowerShell**: バージョン 5.1以上
- **依存関係**: WScript.Shell COMオブジェクト（Windows標準）

## 制限事項

1. **ファイルパスの制限**
   - 実行ファイル（.exe）以外でもショートカット作成可能だが、アイコン自動設定は.exeファイルのみ対応

2. **ネットワークパス**
   - UNCパス（\\server\share\...）は動作する可能性があるが、推奨されない

3. **特殊文字**
   - ショートカット名に使用できない文字（\ / : * ? " < > |）は避ける

## セキュリティ考慮事項

1. **実行ポリシー**
   - PowerShellの実行ポリシーがRestrictedの場合は実行できない
   - 必要に応じて `Set-ExecutionPolicy` で変更が必要

2. **信頼できないパス**
   - 不明なアプリケーションのパスを指定する際は注意
   - マルウェアをスタートアップに登録するリスクを避ける

3. **管理者権限**
   - 全ユーザー用設定時は管理者権限が必要
   - 不要な場合は現在のユーザー用設定を推奨
